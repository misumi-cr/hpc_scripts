#!/bin/bash

cname=g.e213.T62_g17.0024
st_arc_dir=/lustre/wrk/misumi/cesm2/archive
n=5  # Number of years to exclude

target_dir=$st_arc_dir"/"$cname"/ocn/hist"
echo $target_dir

# Define file types
file_types=("h" "dd" "do" "dt" "dv" "h.ecosys.nday1" "h.nday1")

for ft in "${file_types[@]}"
do
    # Get the file list and sort it
    file_list=$(find "$target_dir" -name "$cname.pop.$ft.????-??*" | sort -n -t. -k5,5 -k6,6)

    # Identify the last n years
    last_n_years=$(echo "$file_list" | sed -E 's/.*\.pop\.'$ft'\.([0-9]{4})-[0-9]{2}.*/\1/' | sort -u | tail -n $n)
    echo last_n_years

    # Exclude files from the last n years
    file_list_filtered=$(echo "$file_list" | grep -vE "\.pop\.'$ft'\.($(echo "$last_n_years" | paste -sd'|' -))-[0-9]{2}")

#    echo "Filtered file list for type '$ft':"
#    echo "$file_list_filtered"
#    echo "------------------------"
done