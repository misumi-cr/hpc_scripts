#!/bin/bash

cname=g.e213.T62_g17.0024
st_arc_dir=/lustre/wrk/misumi/cesm2/archive
n=5  # Number of years to exclude

target_dir=$st_arc_dir"/"$cname"/ocn/hist"

# Get the file list and sort it
h_list=$(find "$target_dir" -name "$cname.*.h.????-??.nc" | sort -n -t. -k4,4 -k5,5)

# Identify the last n years
last_n_years=$(echo "$h_list" | sed -E 's/.*\.h\.([0-9]{4})-[0-9]{2}\.nc$/\1/' | sort -u | tail -n $n)

# Exclude files from the last n years
h_list_filtered=$(echo "$h_list" | grep -vE "\.h\.($(echo "$last_n_years" | paste -sd'|' -))-[0-9]{2}\.nc")

echo "$h_list_filtered"